# ADR-0002: 資料庫選型決策

## 狀態

已接受

## 背景

在微服務電商平台的開發中，每個微服務需要選擇適合其數據存儲需求的資料庫。由於不同服務的數據模型和查詢模式各不相同，我們需要為每個服務選擇最合適的資料庫技術，同時確保這些選擇適合本機開發環境。

## 決策

我們決定採用多資料庫架構（Polyglot Persistence），為不同的微服務選擇不同類型的資料庫：

1. **商品服務**: MongoDB (文檔數據庫)
2. **訂單服務**: PostgreSQL (關係型數據庫)
3. **支付服務**: Redis (用於快速交易處理和緩存)
4. **認證服務**: SQLite (輕量級關係型數據庫，適合用戶數據)
5. **共享緩存**: Redis

## 考量因素

- 數據模型的複雜性和靈活性需求
- 查詢模式和性能要求
- 本機開發環境的資源限制
- 開發團隊的技術熟悉度
- 數據一致性和事務需求
- 水平擴展能力
- 開源社區支持和文檔質量

## 方案

### 方案1: 多資料庫架構（已選擇）

為每個微服務選擇最適合其需求的資料庫類型。

**優點:**
- 每個服務可以使用最適合其數據模型的存儲技術
- 服務間的數據隔離符合微服務原則
- 可以根據服務的特定需求進行優化
- 避免單一資料庫成為性能瓶頸

**缺點:**
- 增加了操作複雜性
- 需要管理多種資料庫技術
- 跨服務查詢變得複雜
- 可能需要數據同步機制

### 方案2: 單一資料庫類型

所有服務使用同一種資料庫技術（如PostgreSQL）。

**優點:**
- 簡化操作和維護
- 團隊只需掌握一種資料庫技術
- 更容易實現跨服務查詢
- 統一的備份和恢復策略

**缺點:**
- 不能針對特定服務優化存儲技術
- 可能導致某些服務的數據模型不自然
- 單一資料庫可能成為性能瓶頸
- 不符合微服務的自治原則

### 方案3: 共享資料庫實例

所有服務共享同一個資料庫實例，但使用不同的schema或collection。

**優點:**
- 資源利用率高
- 簡化本地開發環境
- 容易實現跨服務查詢

**缺點:**
- 違反微服務的數據隔離原則
- 服務間耦合度增加
- 難以獨立擴展
- 單點故障風險

## 影響

- **技術影響**: 需要團隊掌握多種資料庫技術
- **資源影響**: 本機開發環境需要運行多個資料庫實例，但可通過Docker Compose管理
- **風險**: 多資料庫環境中的數據一致性挑戰
- **依賴關係**: 需要為每種資料庫技術配置適當的連接池和錯誤處理

## 實施計劃

1. 為每個服務設置獨立的資料庫容器
2. 開發資料庫遷移和種子數據腳本
3. 實現基本的資料訪問層
4. 建立本地開發環境的資料持久化機制

## 評估指標

- 查詢性能
- 開發效率
- 資料一致性維護難度
- 本機開發環境的資源消耗
- 服務獨立部署和擴展能力

## 相關決策

- [ADR-0001](0001-microservices-decomposition.md) - 微服務拆分決策